// codigo para descurtir postagens do instagram em massa
// para usar para excluir coment√°rios, basta mudar os bot√µes de Descurtir para Excluir

(async function() {
  const DELAY_CLICK = 100;        // Delay entre cliques nos √≠cones
  const DELAY_AFTER_SELECT = 500; // Delay ap√≥s clicar no bot√£o "Selecionar"
  const DELAY_AFTER_UNLIKE = 500; // Delay ap√≥s clicar no pop-up "Descurtir"
  const WAIT_BEFORE_LOOP = 10000; // Espera 30 segundos antes de nova itera√ß√£o
  const delay = ms => new Promise(res => setTimeout(res, ms));

  let iteration = 0;

  while (true) { // Loop cont√≠nuo
    iteration++;
    console.log(`\nüöÄ Iniciando itera√ß√£o #${iteration}...`);

    // === Passo 1: clicar no bot√£o "Selecionar/Cancelar" ===
    const buttons = [...document.querySelectorAll('*')]
      .filter(el => {
        const style = window.getComputedStyle(el);
        const text = el.textContent?.trim();
        return ['Selecionar', 'Cancelar', 'Select', 'Ausw√§hlen'].includes(text) &&
               style.display !== 'none' &&
               style.visibility !== 'hidden' &&
               style.pointerEvents !== 'none';
      });

    if (buttons.length > 0) {
      let btn = buttons[0];
      let clickable = btn;
      while (clickable && !['BUTTON', 'A'].includes(clickable.tagName) && !clickable.onclick && clickable.getAttribute('role') !== 'button') {
        clickable = clickable.parentElement;
      }
      if (clickable) {
        clickable.click();
        console.log('‚úÖ Bot√£o "Selecionar/Cancelar" clicado!');
        await delay(DELAY_AFTER_SELECT);
      } else {
        console.log('‚ö†Ô∏è Bot√£o clic√°vel n√£o encontrado.');
      }
    } else {
      console.log('‚ö†Ô∏è Nenhum bot√£o "Selecionar/Cancelar" encontrado.');
    }

    // === Passo 2: selecionar todos os √≠cones vis√≠veis ===
    const icons = [...document.querySelectorAll('div[data-bloks-name="ig.components.Icon"]')];
    if (icons.length === 0) {
      console.log('‚ö†Ô∏è Nenhum √≠cone encontrado.');
    } else {
      console.log(`‚úÖ Encontrados ${icons.length} √≠cones. Selecionando todos...`);
      let totalClicked = 0;
      for (const icon of icons) {
        const clickable = icon.closest('[role="button"]');
        if (clickable) {
          clickable.click();
          totalClicked++;
          // console.log(`‚úîÔ∏è Selecionado item ${totalClicked}`);
          await delay(DELAY_CLICK);
        }
      }
      console.log(`üéâ Todos os ${totalClicked} itens vis√≠veis foram selecionados!`);
    }

    // === Passo 3 e 4: descurtir itens selecionados ===
    const unlikeBtns = [...document.querySelectorAll('span')]
      .filter(span => span.textContent.trim() === 'Descurtir' && span.style.color === 'rgb(237, 73, 86)');

    if (unlikeBtns.length === 0) {
      console.log('‚ö†Ô∏è Nenhum bot√£o "Descurtir" principal encontrado nesta itera√ß√£o.');
    } else {
      for (const mainUnlikeBtn of unlikeBtns) {
        mainUnlikeBtn.click();
        console.log('‚úÖ Bot√£o principal "Descurtir" clicado!');
        await delay(DELAY_AFTER_UNLIKE);

        const popupBtn = [...document.querySelectorAll('div._ap3a._aacp._aacw._aac-._aad6')]
          .find(div => div.textContent.trim() === 'Descurtir');

        if (popupBtn) {
          popupBtn.click();
          console.log('üíî Curtida removida com sucesso!');
        } else {
          console.log('‚ö†Ô∏è Bot√£o "Descurtir" do pop-up n√£o encontrado.');
        }

        await delay(DELAY_AFTER_UNLIKE);
      }
    }

    // === Espera 30 segundos antes de nova itera√ß√£o ===
    console.log(`‚è≥ Esperando ${WAIT_BEFORE_LOOP / 1000} segundos antes de verificar novos itens...`);
    await delay(WAIT_BEFORE_LOOP);
  }
})();
