/* 
https://g1.globo.com/jogos/soletra/
Este código é um gerador automático de palavras com restrições específicas e uma função para submetê-las a um formulário na web. 
Primeiro, define um conjunto de letras disponíveis (letters), uma letra central obrigatória (centralLetter), o tamanho das palavras 
(wordLength) e regras de restrição, como letras ou pares proibidos no início ou fim, e combinações proibidas em qualquer posição, 
incluindo trincas.
Depois, envia automaticamente cada palavra para um formulário na web, simulando digitação e clique, e mostra no console o progresso 
da execução.
*/

// ---------------- CONFIGURAÇÕES ----------------
const letters = ['a','c','e','h','l','o','r']; // letras disponíveis
const centralLetter = 'c';
const wordLength = 5;

// Letra proibida no início
const forbiddenStartLetters = [];
// Pares proibidos no início
const forbiddenStartPairs = ['rr'];

// Letra proibida no final
const forbiddenLastLetters = ['c','h'];
// Pares proibidos no final (restrição extra no final da palavra)
const forbiddenEndPairs = [
  'ch','cl','cr','hc','hl','hr',
  'lc','lh','lr','rc','rh','rl','rr'
];

// Pares proibidos em qualquer posição
const forbiddenPairs = [
  'cc','hh','ll','aa','ee','oo',
  'hc','hl','hr','lr','rh','ah','eh','oh',
  'ch','cl','cr','rc','lc','rl' // adicione todos os pares proibidos aqui também
];
// Trincas proibidos em qualquer posição
const forbiddenTriples = ['rrr'];


// ---------------- FUNÇÕES DE VALIDAÇÃO ----------------
function hasForbiddenPair(word) {
  return forbiddenPairs.some(pair => word.includes(pair));
}

function hasTripleLetter(word) {
  for (let i = 0; i < word.length - 2; i++) {
    if (word[i] === word[i+1] && word[i] === word[i+2]) {
      return true;
    }
  }
  return false;
}

function hasForbiddenTriple(word) {
  return forbiddenTriples.some(triple => word.includes(triple));
}

// ---------------- GERADOR ----------------
function generateWords(current = '', words = []) {

  if (current.length === wordLength) {
    const lastChar = current[current.length - 1];
    const lastTwo = current.slice(-2);

    if (
      current.includes(centralLetter) &&
      !hasForbiddenPair(current) &&
      !hasTripleLetter(current) &&
      !hasForbiddenTriple(current) &&
      !forbiddenLastLetters.includes(lastChar) &&
      !forbiddenEndPairs.includes(lastTwo)
    ) {
      words.push(current);
    }
    return;
  }

  for (let l of letters) {

    // ❌ Evita letra proibida no início
    if (current.length === 0 && forbiddenStartLetters.includes(l)) continue;

    // ❌ Evita pares proibidos no início (posição 0–1)
    if (current.length === 1) {
      const startPair = current + l;
      if (forbiddenStartPairs.includes(startPair)) continue;
    }

    // ❌ Evita pares proibidos em qualquer posição
    if (current.length > 0) {
      const pair = current[current.length - 1] + l;
      if (forbiddenPairs.includes(pair)) continue;
    }

    // ❌ Evita 3 letras iguais seguidas
    if (current.length > 1) {
      const a = current[current.length - 2];
      const b = current[current.length - 1];
      if (a === b && b === l) continue;
    }

    // ❌ Evita trincas específicas
    if (current.length > 1) {
      const triple = current.slice(-2) + l;
      if (forbiddenTriples.includes(triple)) continue;
    }

    generateWords(current + l, words);
  }

  return words;
}

// ---------------- FUNÇÃO DE SUBMISSÃO ----------------
function submitWord(word) {
  const input = document.querySelector('input[type="text"]');
  if (!input) return;

  input.value = word;
  input.dispatchEvent(new Event('input', { bubbles: true }));

  const button = document.querySelector('button.submit');
  const form = input.closest('form');

  if (button) {
    button.click();
  } else if (form) {
    form.requestSubmit?.();
  } else {
    input.dispatchEvent(new KeyboardEvent('keydown', { key: 'Enter', bubbles: true }));
    input.dispatchEvent(new KeyboardEvent('keyup', { key: 'Enter', bubbles: true }));
  }
}

// ---------------- EXECUÇÃO ----------------
const totalCombinations = Math.pow(letters.length, wordLength);
console.log('Total de combinações possíveis sem filtros:', totalCombinations);

const allWords = generateWords();
console.log('Total de combinações válidas após filtros:', allWords.length);

let i = 0;
const total = allWords.length;

const interval = setInterval(() => {
  if (i >= total) {
    clearInterval(interval);
    console.log('✅ Teste finalizado.');
    return;
  }

  const currentWord = allWords[i];
  submitWord(currentWord);
  i++;

  const percent = ((i / total) * 100).toFixed(2);
  console.log(`Testando palavra: "${currentWord}" (${i}/${total}) - ${percent}%`);
}, 200);
